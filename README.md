# Тестовове задание на позицию Junior DevOps.

## 1. Чек-лист

1. Конфиги Kubernetes и Helm

    * Helm-чарты:
        * Проверить, что все Helm-чарты настроены корректно и протестированы в staging либо в тестовом контуре.
        * Настроены все необходимые значения в values.yaml для прода.

    * Ресурсы для каждого Pod:
        * Проверить, что для каждого контейнера заданы requests и limits для CPU и памяти, чтобы предотвратить перезагрузки из-за нехватки ресурсов.

    * Ресурсы Namespaces:
        * Разделить ресурсы на различные namespaces для изоляции среды и обеспечения безопасности.

    * Проверка манифестов:
        * Все манифесты Kubernetes валидированы.

2. База данных (PostgreSQL)

    * Конфиденциальность данных:
        * Данные пользователей зашифрованы при хранении и передаче (с использованием TLS для подключения).

    * Резервное копирование и восстановление:
        * Проверить, настроен ли механизм регулярного резервного копирования данных.
        * Протестировать восстановление данных из резервной копии.

    * Секреты и доступы:
        * Использовать Kubernetes Secrets для хранения конфиденциальных данных (логины и пароли).

    * Репликация и отказоустойчивость:
        * Настроить репликацию и отказоустойчивость для PostgreSQL (например, в кластере).

3. Сетевые настройки и балансировка нагрузки

    * Ingress-контроллер:
        * Настроить и протестировать Ingress-контроллер, который обеспечивает доступ к внешним сервисам.
        * HTTPS включен для всех внешних подключений (TLS / SSL).

    * Балансировка нагрузки:
        * Настроить механизм балансировки нагрузки для равномерного распределения трафика между подами.

    * Сетевая безопасность:
        * Ограничить исходящие и входящие подключения через NetworkPolicies либо на фаерволле.

    * Использование ServiceMesh:
        * Проверить, что ServiceMesh настроен корректно и протестирован (Istio или Linkerd).

4. Секреты и конфиденциальные данные

    * Использование Kubernetes Secrets:
        * Все конфиденциальные данные, такие как API-ключи, пароли и токены, хранить в Secrets.

    * Доступ к Secret ограничен:
        * Настроить роли и права доступа для ограничения доступа к Secrets.

5. Безопасность

    * Контейнерная безопасность:
        * Проверить отсутствие известных уязвимостей в контейнерных образах.
        * Настроить ограничения для контейнеров (allowPrivilegeEscalation: false, readOnlyRootFilesystem и drop ALL capabilities).

    * Изоляция подов:
        * Настроить PodSecurityPolicies для минимизации прав на уровне пода.

    * RBAC:
        * Разграничены роли и права доступа для пользователей и сервисных аккаунтов.

6. Мониторинг и логирование

    * Мониторинг приложений:
        * Настроить метрики для каждого микросервиса с помощью системы мониторинга.
        * Установлены алерты на критичные показатели (использование CPU / памяти, задержки, ошибки запросов).

    * Логирование:
        * Логи всех приложений собираются и отправляются в централизованную систему логирования.
        * Настроить ротацию логов.

    * Отчётность по инцидентам:
        * Настроены уведомления для оповещения команды в случае критических событий (бот в телеге).

7. Подготовка к аварийным ситуациям

    * Настроить механизмы автоскейлинга:
        * Проверить, что включен HPA для каждого микросервиса.

    * Проверка стратегии развертывания:
        * Настроить подходящая стратегия деплоя для уменьшения времени простоя и отказов.

## 2. Поправить возможные мисконфигурации в микросервисном приложении

Представлено вторым коммитом

### Зависимости

Docker, kubectl, helm, [k3d](https://k3d.io/v5.7.4/)

### Установка локального кластера

```bash
k3d cluster create devops-bs-test --image rancher/k3s:v1.27.10-k3s2
```

### Установка микросервисов в локальный кластер

```bash
helm upgrade -i --atomic --timeout 5m onlineboutique ./helm-chart
```

### Прокидывание порта до фронтенда

```bash
kubectl port-forward -n default svc/frontend 8080:80
```
